{% extends "base.html" %}

{% block content %}

<head>
    <title>Cybercoach Selection</title>
</head>

<h1>Select a CyberCoach</h1>
<form action="{% url 'cybercoach' %}" method="POST">
    {% csrf_token %}
    <label for="coach-select">Choose a coach:</label>
    <select id="coach-select" name="coach" onchange="updateModelDropdown()">
        {% for coach, paths in cybercoach_paths.items %}
            <option value="{{ coach }}">{{ coach }}</option>
        {% endfor %}
    </select>

    <label for="model-select">Choose a model type:</label>
    <select id="model-select" name="model_type">
        <!-- Options will be added here based on the first dropdown's selection -->
    </select>

    <button type="submit">Submit</button>
</form>

{{ cybercoach_paths|json_script:"cybercoachPathsData" }}

<script>
    function updateModelDropdown() {
        const coachSelect = document.getElementById('coach-select');
        const modelSelect = document.getElementById('model-select');
        const selectedCoach = coachSelect.value;

        // Access the embedded JSON data
        const cybercoachPaths = JSON.parse(document.getElementById('cybercoachPathsData').textContent);
        const models = cybercoachPaths[selectedCoach];

        // Clear existing options in the model dropdown
        while (modelSelect.firstChild) {
            modelSelect.removeChild(modelSelect.firstChild);
        }

        // Populate the model dropdown with new options
        for (const model in models) {
            const option = document.createElement('option');
            option.value = model;
            option.text = model;
            modelSelect.appendChild(option);
        }
    }

    // Initialize the model dropdown with the first coach's models
    window.onload = updateModelDropdown;
</script>

{% endblock %}
