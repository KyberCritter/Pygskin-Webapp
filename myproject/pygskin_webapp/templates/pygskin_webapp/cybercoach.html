{% extends "base.html" %}

{% block title %}{{ model_type }} Cybercoach of {{ coach_name }}{% endblock %}

{% block content %}

<h1>{{ model_type }} Cybercoach of {{ coach_name }} {% if first_year == last_year %}({{ first_year }}){% else %}({{ first_year }}-{{ last_year }}){% endif %}</h1>
<p>This Cybercoach is a {{ model_type }} model trained on 80% of {{ coach_name }}'s offensive play calls from the beginning of the {{ first_year }} season to the end of the {{ last_year }} season. 20% of the plays were withheld from the training set in order to be used in the evaluation of the model. This model was <strong>{{ model_accuracy }}%</strong> accurate on the evaluation data set.</p>
<p><strong>Next, <a href="#play-input">input a custom scenario</a> OR <a href="#coach-selector">pick a year and a game</a>.</strong></p>

<section id="play-input-section">
<div class="play-input" id="play-input">
    <h2>Create a Custom Scenario</h2>
    <p>Fill out the options below to predict what play {{ coach_name }} would call in a brand-new scenario of your choice.</p>
    <form action="{% url 'custom_prediction' %}" method="POST">
        {% csrf_token %}
        <div class="form-row">
            <div class="form-group">
                {{ custom_scenario_form.yard_line.as_field_group }}
            </div>
            <div class="form-group">
                {{ custom_scenario_form.down.as_field_group }}
            </div>
            <div class="form-group">
                {{ custom_scenario_form.distance.as_field_group }}
            </div>
        </div>
        <div class="form-row">
            <div class="form-group">
                {{ custom_scenario_form.period.as_field_group }}
            </div>
            <div class="form-group">
                {{ custom_scenario_form.minutes_remaining_in_quarter.as_field_group }}
            </div>
            <div class="form-group">
                {{ custom_scenario_form.seconds_remaining_in_quarter.as_field_group }}
            </div>
        </div>
        <div class="form-row">
            <div class="form-group">
                {{ custom_scenario_form.offense_score.as_field_group }}
            </div>
            <div class="form-group">
                {{ custom_scenario_form.defense_score.as_field_group }}
            </div>
            <div class="form-group">
                {{ custom_scenario_form.offense_timeouts.as_field_group }}
            </div>
            <div class="form-group">
                {{ custom_scenario_form.defense_timeouts.as_field_group }}
            </div>
        </div>
        <div class="form-row">
            <div class="form-group">
                {{ custom_scenario_form.rushing_yards_per_attempt.as_field_group }}
            </div>
            <div class="form-group">
                {{ custom_scenario_form.passing_yards_per_attempt.as_field_group }}
            </div>
        </div>
        <button type="submit" data-umami-event="custom-scenario-submit">Submit</button>
    </form>
</div>
</section>

<section id="coach-selector-section">
<div class="coach-selector" id="coach-selector">
    <h2>Select a Year and Game</h2>
    <p>Conference, non-conference, and conference championships (if applicable) are available. Postseason (playoff and bowl) games will be added at a later date. Week 0 games are listed as Week 1.</p>
    <form action="{% url 'drive_select' %}" method="POST">
        {% csrf_token %}
        <div class="form-row">
            <div class="form-group col-md-6">
                <label for="year-select">Choose a year:</label>
                <select id="year-select" name="year" onchange="updateOpponentDropdown()" class="form-control">
                    {% for year, x in opponents_by_year.items %}
                        <option value="{{ year }}">{{ year }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-group col-md-6">
                <label for="opponent-select">Choose a game:</label>
                <select id="opponent-select" name="opponent" class="form-control">
                    <!-- Options will be added here based on the first dropdown's selection -->
                </select>
            </div>
        </div>
        <button type="submit" class="btn btn-primary">Submit</button>
    </form>
</div>
</section>

{{ opponents_by_year|json_script:"opponentYearsData" }}

<script>
    function updateOpponentDropdown() {
        const yearSelect = document.getElementById('year-select');
        const opponentSelect = document.getElementById('opponent-select');
        const selectedYear = yearSelect.value;

        // Access the embedded JSON data
        const opponentYears = JSON.parse(document.getElementById('opponentYearsData').textContent);
        const opponents = opponentYears[selectedYear];

        // Clear existing options in the opponent dropdown
        while (opponentSelect.firstChild) {
            opponentSelect.removeChild(opponentSelect.firstChild);
        }

        // Populate the opponent dropdown with new options
        for (var i = 0, l = opponents.length; i < l; i++) {
            var opponent = opponents[i][0];
            var week = opponents[i][1];
            const option = document.createElement('option');
            option.value = [opponent, week];
            option.text = opponent.concat(" (Week ", week, ")");
            opponentSelect.appendChild(option);
        }
    }

    // Initialize the opponent dropdown with the first year's opponents
    window.onload = updateOpponentDropdown;
</script>

{% endblock %}
